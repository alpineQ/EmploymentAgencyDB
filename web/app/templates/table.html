{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between">
    <h1>
        <a style="color: black;font-size:smaller;" href="/"><i class="fa fa-long-arrow-left"></i></a> {{
        tables[name]['name'] }}
    </h1>

    <form>
        <a href="/{{name}}/add/" class="btn btn-success mt-2 mb-2">
            <i class="fa fa-plus"></i> <b>Добавить запись</b>
        </a>
    </form>
</div>

<form class="input-group mb-3">
    <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-toggle="dropdown"
            id="field_dropdown">
        {% if search_field %}
        {{ fields[column_names.index(search_field)] }}
        {% else %}
        {{ fields[1] }}
        {% endif %}
    </button>
    <ul class="dropdown-menu">
        {% for field, column_name in zip(fields[1:], column_names[1:]) %}
        <li><a class="dropdown-item" style="cursor: pointer;"
               onclick="document.getElementById(&quot;search_field&quot;).value=&quot;{{ column_name }}&quot;; document.getElementById(&quot;field_dropdown&quot;).innerText=&quot;{{ field }}&quot;">
            {{ field }}
        </a></li>
        {% endfor %}
    </ul>
    <input name="search_query" type="text" class="form-control"
           {% if search_query %}
           value="{{ search_query }}"
           {% endif %}
           required>
    <button formmethod="get" formaction="/{{name}}/" class="btn btn-success" id="search_field"
            name="search_field"
            {% if search_field %}
            value="{{ search_field }}"
            {% else %}
            value="{{ column_names[1] }}"
            {% endif %}><b>Поиск</b></button>
</form>

<div class="table-responsive">
    <table class="table">
        <thead>
        <tr>
            {% for field, column_name in zip(fields[1:], column_names[1:]) %}
            <th style="cursor: pointer;"
                {% if column_name == sort_by %}
                onclick="window.location='?sort_by={{ column_name }}&desc={{ not sort_descending }}'"
                {% else %}
                onclick="window.location='?sort_by={{ column_name }}'"
                {% endif %}
                class="text-center" scope="col">{{ field }}</th>
            {% endfor %}
        </tr>
        </thead>
        <tbody>
        {% for record in table_data %}
        <tr onclick="window.location='./{{ record[0] }}/'" class="list-group-item-action"
            style="cursor: pointer;">
            {% for field, type in zip(record[1:], types[1:]) %}
            <td class="text-center">
                {% if type == 'uniqueidentifier' and field != None %}
                {{ field[:8] }}
                {% elif type == 'datetime' and field != None %}
                {% set date = (field).__str__() %}
                {{ date[:date.find(' ')] }}
                {% elif type == 'bit' %}
                <input class="form-check-input" type="checkbox"
                       {% if field== 1 %}
                       checked
                       {% endif %} disabled>
                {% elif type == 'money' %}
                {% set money = field.__str__() %}
                {{ money[:money.find('.')] }}
                {% else %}
                {{ field }}
                {% endif %}
            </td>
            {% endfor %}
        </tr>
        {% endfor %}
    </table>
</div>
{% endblock %}